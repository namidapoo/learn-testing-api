# TODOアプリバックエンドAPI 要件定義書

## 1. 概要
Next.jsアプリケーション用のTODOアプリバックエンドAPIを作成する。テスト駆動開発（TDD）の実践を目的とし、基本的なCRUD操作を網羅する。

## 2. 技術スタック
- **フレームワーク**: Hono
- **バリデーション/OpenAPI**: Hono Zod OpenAPI
- **データベース**: Cloudflare D1
- **ORM**: Drizzle ORM
- **テストフレームワーク**: 
  - Vitest
  - Bun内蔵テストランナー（並行実装）
- **開発手法**: t-wadaのTDD手法に準拠
- **APIドキュメント**: Swagger UI

### 2.1 Hono Zod OpenAPIを採用する理由
- **公式サポート**: Hono公式パッケージのため、長期的なメンテナンスが期待できる
- **統合的なアプローチ**: ルート定義、バリデーション、OpenAPIスキーマが一体化
- **型安全性**: ZodとTypeScriptの型が完全に連携し、コンパイル時の型チェックが可能
- **TDDとの相性**: スキーマファーストなアプローチがテスト駆動開発と相性が良い
- **開発効率**: スキーマ定義から自動的にバリデーションとドキュメントが生成される

## 3. 機能要件

### 3.1 TODO管理機能
以下のCRUD操作を実装する：

#### 3.1.1 Create（作成）
- 新しいTODOアイテムを作成できる
- 必須フィールド：タイトル
- オプションフィールド：説明、期限
- 作成日時は自動設定

#### 3.1.2 Read（読み取り）
- 全TODOアイテムの一覧取得
- 特定のTODOアイテムの詳細取得（ID指定）
- フィルタリング機能：
  - 完了/未完了でのフィルタ
  - 期限でのソート

#### 3.1.3 Update（更新）
- TODOアイテムの内容を更新できる
- 更新可能フィールド：タイトル、説明、完了状態、期限
- 更新日時は自動更新

#### 3.1.4 Delete（削除）
- 特定のTODOアイテムを削除できる（ID指定）
- 論理削除ではなく物理削除とする

### 3.2 データモデル
```
TODO {
  id: string (UUID)
  title: string (必須、最大100文字)
  description: string (オプション、最大500文字)
  completed: boolean (デフォルト: false)
  dueDate: date (オプション)
  createdAt: timestamp
  updatedAt: timestamp
}
```

## 4. 非機能要件

### 4.1 テスト要件
- すべての機能に対してテストを作成する
- テストカバレッジ80%以上を目標とする
- Red-Green-Refactorサイクルを厳守する
- VitestとBunテストの両方で同等のテストを実装する

### 4.2 API設計
- RESTful APIとして設計する
- Hono Zod OpenAPIを使用してスキーマ定義とバリデーションを実装
  - `createRoute`でルート定義とOpenAPIスキーマを同時に定義
  - Zodスキーマによる厳密な型定義とバリデーション
  - 自動的なリクエスト/レスポンスの検証
- エンドポイント構成：
  - `GET /api/todos` - 一覧取得
  - `GET /api/todos/:id` - 詳細取得
  - `POST /api/todos` - 新規作成
  - `PUT /api/todos/:id` - 更新
  - `DELETE /api/todos/:id` - 削除
- JSONでのリクエスト/レスポンス
- 適切なHTTPステータスコードを返す
- OpenAPI仕様に準拠したドキュメント自動生成
- Swagger UIでのAPI確認を可能にする（開発環境）

### 4.3 エラーハンドリング
- バリデーションエラーの適切な処理
- データベースエラーの適切な処理
- 一貫性のあるエラーレスポンス形式

## 5. 開発の進め方
1. テストファースト（Red）でテストを書く
2. テストが通る最小限の実装を行う（Green）
3. コードをリファクタリングする（Refactor）
4. 上記サイクルを機能ごとに繰り返す

## 6. 成果物
- 完全に動作するTODO API
- Vitestによるテストスイート
- Bunテストによるテストスイート
- D1データベースのスキーマとマイグレーション
- APIドキュメント（エンドポイント仕様）
- OpenAPI仕様ファイル
- Swagger UIでの確認環境
